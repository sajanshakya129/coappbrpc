<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CoAP Protobuf RPC library: Protobuf RPC over CoAP protocol(UDP)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CoAP Protobuf RPC library
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Protobuf RPC over CoAP protocol(UDP) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This library is developed to create a RPC that utilises features of CoAP protocol which uses UDP for transport. Protobuf is used as Interface Definition language(IDL). The goal is to use this RPC library over Constrained IoT devices.</p>
<h2>Getting Started</h2>
<p>The following steps are written with the consideration that the system for development is fresh newly installed Linux Based System.</p>
<h3>Prerequisites</h3>
<p>Please install following applications to build and install coappbrpc. </p><div class="fragment"><div class="line">sudo apt-get install cmake build-essential dh-autoreconf python python-pip</div></div><!-- fragment --> <h4>Protocol buffer library Installation</h4>
<p>Follow the following link and https://github.com/protocolbuffers/protobuf/blob/master/src/README.md "install protobuf" Or follow the following steps </p><div class="fragment"><div class="line">git clone https://github.com/protocolbuffers/protobuf.git</div><div class="line">cd protobuf</div><div class="line">git submodule update --init --recursive</div><div class="line">./autogen.sh</div><div class="line">./configure</div><div class="line">make</div><div class="line">make check</div><div class="line">sudo make install</div><div class="line">sudo ldconfig # refresh shared library cache.</div></div><!-- fragment --><p>#### LibCoAP Library Installation </p><div class="fragment"><div class="line">git clone https://github.com/obgm/libcoap.git</div><div class="line">cd libcoap</div></div><!-- fragment --><p> OPTIONAL:You might need to install pkg-config in your system if 'pkg-config' is not found. </p><div class="fragment"><div class="line">sudo apt-get install pkg-config</div></div><!-- fragment --><p> Then configure libcoap and install libcoap </p><div class="fragment"><div class="line">./autogen.sh</div><div class="line">./configure --disable-doxygen --disable-manpages</div><div class="line">make</div><div class="line">sudo make install</div><div class="line">sudo ldconfig /usr/local/lib</div></div><!-- fragment --><p>## Installation of CoAPPbrpc library </p><div class="fragment"><div class="line">git clone --single-branch -b newbranch https://github.com/sajanshakya129/coappbrpc</div><div class="line">mkdir build &amp;&amp; cd build</div><div class="line">cmake ..</div><div class="line">make</div><div class="line">sudo make install</div></div><!-- fragment --><h2>Running Example</h2>
<p>Go to example/src folder and generate stub files required using following commands. </p><div class="fragment"><div class="line">cd [Project Folder]/example/</div><div class="line">coappbrpc.sh rpc_ping.proto</div></div><!-- fragment --><p> ClientStub.sh ClientStub.h are autogenerated.</p>
<p>### Compiling and Running using cmake </p><div class="fragment"><div class="line">mkdir build &amp;&amp; cd build &amp;&amp; cmake ..</div><div class="line">make</div></div><!-- fragment --> <h4>Running client</h4>
<p>In example folder, bin folder is created with executable files i.e. client and server </p><div class="fragment"><div class="line">./bin/client</div></div><!-- fragment --><p> #### Running Server </p><div class="fragment"><div class="line">./bin/server</div></div><!-- fragment --><p> OR</p>
<p>### Compiling and Running Client from terminal manually </p><div class="fragment"><div class="line">g++ -o client rpc_ping.pb.cc ClientStub.cc client.cpp -lcoappbrpc -lcoap-2 -lprotobuf -lpthread</div><div class="line">./client</div></div><!-- fragment --><p> ### Compiling and Running Server from terminal manually </p><div class="fragment"><div class="line">g++ -o server rpc_ping.pb.cc server.cpp -lcoappbrpc -lcoap-2 -lprotobuf -lpthread</div><div class="line">./server</div></div><!-- fragment --><h2>Documentation</h2>
<p>Detailed explanation of functions and classes can be found in folder documentation. You can run web based documentation by running documentation/html/index.html file</p>
<h2>Creating Proto File</h2>
<p>To create a service for RPC, you need to define the response and request schema along with defination of Service in protofile as shown below. </p><div class="fragment"><div class="line">{c++}</div><div class="line">syntax = &quot;proto3&quot;; // Denotes that we are using Protocol buffers 3 for compiling</div><div class="line"></div><div class="line">package coappbrpc.api; // Packaging codes under coappbrpc.api namespace</div><div class="line"></div><div class="line">option cc_generic_services = true;// To use protocol buffers services</div><div class="line"></div><div class="line">message PingRequest {  // User defined Request named &quot;PingRequest&quot; with parameter &quot;msg&quot;. </div><div class="line">    string msg = 1; // For multiple parameters the numbering is done in increasing format </div><div class="line">    //which is non-repititive or cannot be duplicate.</div><div class="line">}</div><div class="line"></div><div class="line">message PingResponse {  // User defined Response named &quot;PingResponse&quot; with parameter &quot;result&quot;. </div><div class="line">    string result = 1;</div><div class="line">}</div><div class="line"></div><div class="line">service PingService { //User defined Service named &quot;PingService&quot; </div><div class="line">    rpc Ping (PingRequest) returns (PingResponse); //User defined method named &quot;Ping&quot; which takes &quot;PingRequest&quot; as input </div><div class="line">    //and give &quot;PingResponse&quot; as output.</div><div class="line">}</div></div><!-- fragment --><p>## Creating Client </p><div class="fragment"><div class="line">{c++}</div><div class="line">#include &lt;coappbrpc/RpcClient.h&gt; // To Create client you must include this file: coappbrpc/RpcClient.h</div><div class="line"></div><div class="line">#include &quot;ClientStub.h&quot; //including ClientStub.h generated when you run &quot;coappbrpc.sh &lt;protofile&gt;&quot; in command prompt.</div><div class="line">#include &quot;rpc_ping.pb.h&quot; //including rpc_ping.pb.h generate when you run &quot;coappbrpc.sh &lt;protofile&gt;&quot; </div><div class="line">//in command prompt. &lt;filename.proto&gt; will generate &quot;filename.pb.h&quot; and &quot;filename.pb.cc&quot;</div><div class="line"></div><div class="line">#include &lt;string&gt;</div><div class="line"></div><div class="line">using ::coappbrpc::RpcClient;  //Must be included in code</div><div class="line">using ::coappbrpc::api::PingRequest; //Must be included in code</div><div class="line">using ::coappbrpc::api::PingResponse; //Must be included in code</div><div class="line">using ::coappbrpc::api::PingService; //Must be included in code</div><div class="line">using namespace std;</div><div class="line"></div><div class="line">class PingClient { //Defining Client Class</div><div class="line">public:</div><div class="line">  string ping(const string &amp;msg) { //Defining method ping where we use RPC call</div><div class="line"></div><div class="line">    PingRequest request;</div><div class="line">    request.set_msg(msg); //Setting user msg to request. </div><div class="line">    //Note: In set_msg, msg is the parameter that we defined in protofile request.</div><div class="line"></div><div class="line">    PingResponse response;</div><div class="line">    stub.Ping(request, &amp;response); // This is where actual RPC call is done.</div><div class="line">   //Note: Ping is the method that we defined in protofile.</div><div class="line"></div><div class="line">    return response.result();</div><div class="line">  }</div><div class="line"></div><div class="line">private:</div><div class="line">    ClientStub stub; //creating instance of Client Stub</div><div class="line">};</div><div class="line"></div><div class="line">int main(void) {</div><div class="line">  GOOGLE_PROTOBUF_VERIFY_VERSION; //verifiying protocol buffers version</div><div class="line">  RpcClient *client = RpcClient::getInstance(); //creating a client instance</div><div class="line">  client-&gt;setServerAddr(&quot;localhost:5683&quot;); //setting up Server address. Default is &quot;localhost:5683&quot;. </div><div class="line">                                        //Note: must be in format &lt;server_address&gt;:&lt;port_no&gt;</div><div class="line">  std::string msg(&quot;Hello world&quot;); //defining msg to be sent to Server.</div><div class="line"></div><div class="line">  PingClient pclient;</div><div class="line">  std::string reply = pclient.ping(msg);</div><div class="line">  std::cout &lt;&lt; &quot;Ping received: &quot; &lt;&lt; reply &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><p>## Creating Server </p><div class="fragment"><div class="line">{c++}</div><div class="line">#include &lt;coappbrpc/RpcServer.h&gt; //To create server you must include this file: coappbrpc/RpcServer.h</div><div class="line">#include &quot;rpc_ping.pb.h&quot; //including rpc_ping.pb.h generate when you run &quot;coappbrpc.sh &lt;protofile&gt;&quot; in command prompt.</div><div class="line">                        //&lt;filename.proto&gt; will generate &quot;filename.pb.h&quot; and &quot;filename.pb.cc&quot;</div><div class="line"></div><div class="line">using ::coappbrpc::RpcServer; //Must be included in code</div><div class="line"></div><div class="line">namespace coappbrpc {</div><div class="line">namespace api {</div><div class="line"></div><div class="line">using ::google::protobuf::Closure; //Must be included in code</div><div class="line">using ::google::protobuf::RpcController; //Must be included in code</div><div class="line"></div><div class="line">class PingServiceImpl : public PingService { //User defined class name PingServiceImpl which inherits from PingService class.</div><div class="line">public:</div><div class="line">  PingServiceImpl(){};</div><div class="line"></div><div class="line">  virtual void Ping(RpcController *controller, const PingRequest *request,</div><div class="line">                    PingResponse *response, Closure *done) { </div><div class="line">    //Defining Function named &quot;Ping&quot; which is defined as method in protobuf file. This is where you do </div><div class="line">    //processing and generate result and set result. </div><div class="line"></div><div class="line">    // Do your processing here</div><div class="line"></div><div class="line">    //Setting  result and accessing request parameter &quot;msg&quot;.</div><div class="line"></div><div class="line">    response-&gt;set_result(&quot;I got your message: &quot; + request-&gt;msg()); </div><div class="line">  }</div><div class="line">};</div><div class="line"></div><div class="line">} // namespace api</div><div class="line">} // namespace coappbrpc</div><div class="line"></div><div class="line">int main() {</div><div class="line">  RpcServer server; //Creating instance of server</div><div class="line">  server.registerService(new ::coappbrpc::api::PingServiceImpl()); //Registering service</div><div class="line">  server.runServer(); //running server</div><div class="line">  // server.runServer(&quot;localhost:5683&quot;);// You can run server by providing server_address and port no.</div><div class="line">  return 0;</div><div class="line">}</div></div><!-- fragment --><h2>Uninstall library</h2>
<p>To uninstall library and files related from your system. you need to execute following command. </p><div class="fragment"><div class="line">sudo uninstall_coappbrpc.sh</div></div><!-- fragment --><h2>Authors</h2>
<ul>
<li><b>Sajan Shakya</b> - <em>Initial work</em> - <a href="https://github.com/sajanshakya129">Github</a></li>
</ul>
<h2>References</h2>
<p>This library was created referring to library <a href="https://github.com/madwyn/libpbrpc">LibPbrpc</a> and gRPC.</p>
<h2>License</h2>
<p>This project is licensed under the MIT License - see the <a class="el" href="md_LICENSE.html">LICENSE.md</a> file for details </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
