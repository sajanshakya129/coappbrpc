# Protobuf RPC over CoAP

## Dependency
Please install following application to build and run coappbrpc
```
sudo apt-get install cmake build-essential dh-autoreconf python python-pip
```
### Protocol buffer library
Follow the following link and [install protobuf](https://github.com/protocolbuffers/protobuf/blob/master/src/README.md)
Or follow the following steps
```
$ git clone https://github.com/protocolbuffers/protobuf.git
$ cd protobuf
$ git submodule update --init --recursive
$ ./autogen.sh

$ ./configure
$ make
$ make check
$ sudo make install
$ sudo ldconfig # refresh shared library cache.
```

### Installation of LibCoAP
```
git clone https://github.com/obgm/libcoap.git
cd libcoap

```
OPTIONAL:You might need to install pkg-config in your system if 'pkg-config' is not found.
```
sudo apt-get install pkg-config
```
Then configure libcoap and install libcoap
```
./autogen.sh
./configure --disable-doxygen --disable-manpages
make
sudo make install
sudo ldconfig /usr/local/lib
```

## Installation
```
git clone --recurse-submodules https://github.com/sajanshakya129/coappbrpc
mkdir build && cd build
cmake ..
make
sudo make install
```

## Running Example
Go to example/src folder and generate stub files required using following commands.
```
cd ../example/src/
coappbrpc.sh rpc_ping.proto
```
ClientStub.sh ClientStub.hh are autogenerated.

## Compiling and Running Client
```
g++ -o client rpc_ping.pb.cc ClientStub.cc client.cpp -lcoappbrpc -lcoap-2 -lprotobuf -lpthread
./client
```
## Compiling and Running Server
```
g++ -o server rpc_ping.pb.cc server.cpp -lcoappbrpc -lcoap-2 -lprotobuf -lpthread
./server
```