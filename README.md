# Protobuf RPC over CoAP protocol(UDP)

<a href="https://scan.coverity.com/projects/sajanshakya129-coappbrpc">
  <img alt="Coverity Scan Build Status"
       src="https://scan.coverity.com/projects/17289/badge.svg"/>
</a>

This library is developed to create a RPC that utilises features of CoAP protocol which uses UDP for transport. 
Protobuf is used as Interface Definition language(IDL). The goal is to use this RPC library over Constrained IoT devices.

## Getting Started
The following steps are written with the consideration that the system for development is fresh newly installed Linux Based System.

### Prerequisites
Please install following applications to build and install coappbrpc.
```bash
sudo apt-get install cmake build-essential dh-autoreconf python python-pip
```
#### Protocol buffer library Installation
Follow the following link and [install protobuf](https://github.com/protocolbuffers/protobuf/blob/master/src/README.md)
Or follow the following steps
```bash
sudo apt-get install libprotobuf-dev protobuf-compiler
```

#### LibCoAP version 2 Library Installation
```bash
git clone https://github.com/obgm/libcoap.git
cd libcoap

```
OPTIONAL:You might need to install pkg-config in your system if 'pkg-config' is not found.
```bash
sudo apt-get install pkg-config
```
Then configure libcoap and install libcoap
```bash
./autogen.sh
./configure --disable-doxygen --disable-manpages
make
sudo make install
sudo ldconfig /usr/local/lib
```

## Installation of CoAPPbrpc library
```bash
git clone --single-branch -b newbranch https://github.com/sajanshakya129/coappbrpc
mkdir build && cd build
cmake ..
make
sudo make install
```

## Running Example
Go to example/src folder and generate stub files required using following commands.
```bash
cd [Project Folder]/example/
coappbrpc.sh rpc_ping.proto
```
ClientStub.sh ClientStub.h are autogenerated.

### Compiling and Running using cmake
```bash
mkdir build && cd build && cmake ..
make
```
#### Running client
In example folder, bin folder is created with executable files i.e. client and server
```bash
./bin/client
```
#### Running Server
```bash
./bin/server
```
OR

### Compiling and Running Client from terminal manually
```bash
g++ -o client rpc_ping.pb.cc ClientStub.cc client.cpp -lcoappbrpc -lcoap-2 -lprotobuf -lpthread
./client
```
### Compiling and Running Server from terminal manually
```bash
g++ -o server rpc_ping.pb.cc server.cpp -lcoappbrpc -lcoap-2 -lprotobuf -lpthread
./server
```

## Documentation
Detailed explanation of functions and classes can be found in folder documentation. You can run web based documentation by running documentation/html/index.html file. You can also check WiKi for supportive documentations


## Uninstall library
To uninstall library and files related from your system. you need to execute following command.
```
sudo uninstall_coappbrpc.sh
```

## Authors

* **Sajan Shakya** - *Initial work* - [Github](https://github.com/sajanshakya129)

## References
This library was created referring to library [LibPbrpc](https://github.com/madwyn/libpbrpc) and [gRPC](https://grpc.io/).

## License
This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details
